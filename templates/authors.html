{% extends "base.html" %}

{% block content %}
    <!-- Search Form -->
    <!-- New Elasticsearch Search Bar Form -->
    <form action="{{ url_for('es_search') }}" method="get" class="search-form">
        <input type="text" name="query" placeholder="Elasticsearch: Search for authors and quotes...">
        <input type="submit" value="Search">
    </form>



    <h1>Top 15 Authors</h1>

    <!-- Top Authors List -->
    <div class="top-authors">
        <ol>
        <li><a href="{{ url_for('author_quotes', author='Oscar Wilde') }}">Oscar Wilde</a></li>
        <li><a href="{{ url_for('author_quotes', author='William Shakespeare') }}">William Shakespeare</a></li>
        <li><a href="{{ url_for('author_quotes', author='Mark Twain') }}">Mark Twain</a></li>
        <li><a href="{{ url_for('author_quotes', author='Friedrich Nietzsche') }}">Friedrich Nietzsche</a></li>
        <li><a href="{{ url_for('author_quotes', author='Albert Einstein') }}">Albert Einstein</a></li>
        <li><a href="{{ url_for('author_quotes', author='Ralph Waldo Emerson') }}">Ralph Waldo Emerson</a></li>
        <li><a href="{{ url_for('author_quotes', author='Johann Wolfgang von Goethe') }}">Johann Wolfgang von Goethe</a></li>
        <li><a href="{{ url_for('author_quotes', author='George Bernard Shaw') }}">George Bernard Shaw</a></li>
        <li><a href="{{ url_for('author_quotes', author='Winston Churchill') }}">Winston Churchill</a></li>
        <li><a href="{{ url_for('author_quotes', author='Benjamin Franklin') }}">Benjamin Franklin</a></li>
        <li><a href="{{ url_for('author_quotes', author='Abraham Lincoln') }}">Abraham Lincoln</a></li>
        <li><a href="{{ url_for('author_quotes', author='Mahatma Gandhi') }}">Mahatma Gandhi</a></li>
        <li><a href="{{ url_for('author_quotes', author='Voltaire') }}">Voltaire</a></li>
        <li><a href="{{ url_for('author_quotes', author='Buddha') }}">Buddha</a></li>
        <li><a href="{{ url_for('author_quotes', author='Thomas Jefferson') }}">Thomas Jefferson</a></li>
     </ol>
</div>

        <h2>Selected Authors</h2>
    <div class="quotes-container">
        {% for author, quote in selected_authors_with_quotes.items() %}
            <div class="quote-card" style="display: flex; align-items: center;">
                <div class="quote-content">
                    <p>{{ quote }}</p>
                    <p class="author-name"><a href="{{ url_for('author_quotes', author=author) }}">{{ author }}</a></p>

                    <!-- Quote Actions -->
                    <div class="quote-actions">
                        <!-- Favorite Button -->
                        <button class="favorite-button" onclick="toggleFavorite({{ quote.id }}, this)">Favorite</button>
                        <p class="error-message" style="display: none; color: red;"></p>

                        <!-- Share Button -->
                        <button class="share-button" onclick="showSharePopup('http://thinkexist.net/quote_detail/{{ quote.id }}', this)">Share</button>
                        <div class="share-popup" style="display: none;">
                            <p>Share this quote:</p>
                            <input type="text" value="http://thinkexist.net/quote_detail/{{ quote.id }}" readonly>
                            <button onclick="copyToClipboard(this)">Copy</button>
                            <button onclick="closeSharePopup(this)">Close</button>
                        </div>

                        <!-- Form to Add Quote to Collection -->
                        <form action="{{ url_for('collections.add_to_collection') }}" method="POST">
                            <select name="collection_id">
                                {% for collection in current_user.collections %}
                                    <option value="{{ collection.id }}">{{ collection.name }}</option>
                                {% endfor %}
                                <option value="new">Create New Collection</option>
                            </select>
                            <input type="hidden" name="quote_id" value="{{ quote.id }}">
                            <input type="submit" value="Add to Collection">
                        </form>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>

    {% if query %}
        <h3>Search Results for "{{ query }}"</h3>
        <ul class="search-results">
            {% for author in authors %}
                <li><a href="{{ url_for('author_quotes', author=author) }}">{{ author }}</a></li>
            {% endfor %}
        </ul>
    {% endif %}

    <script>
        function toggleFavorite(quoteId, buttonElement) {
            fetch(`/toggle_favorite/${quoteId}`, { method: 'POST' })
            .then(response => {
                if (response.ok) {
                    // Update UI to reflect favorite status change
                    // E.g., change the button text or style
                } else if (response.status === 401) { // 401 status code for Unauthorized
                    buttonElement.nextElementSibling.textContent = 'Must be logged in to favorite quotes';
                    buttonElement.nextElementSibling.style.display = 'block';
                } else {
                    buttonElement.nextElementSibling.textContent = 'Failed to toggle favorite status.';
                    buttonElement.nextElementSibling.style.display = 'block';
                }
            })
            .catch(error => {
                console.error('Error:', error);
                buttonElement.nextElementSibling.textContent = 'An error occurred.';
                buttonElement.nextElementSibling.style.display = 'block';
            });
        }

        function showSharePopup(shareUrl, buttonElement) {
            let popup = buttonElement.nextElementSibling;
            popup.style.display = 'block';
            let inputField = popup.querySelector('input');
            inputField.value = shareUrl;
            inputField.select();
        }

        function closeSharePopup(buttonElement) {
            let popup = buttonElement.parentElement;
            popup.style.display = 'none';
        }

        function copyToClipboard(buttonElement) {
            let inputField = buttonElement.parentElement.querySelector('input');
            inputField.select();
            document.execCommand('copy');
            alert('Link copied to clipboard!');
        }
    </script>
{% endblock %}





