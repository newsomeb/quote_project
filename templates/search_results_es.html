{% extends "base.html" %}

{% block content %}



<!-- Search Bar Form -->
<form action="{{ url_for('es_search') }}" method="get" class="search-form">
    <input type="text" name="query" placeholder="Search for authors and quotes..." value="{{ query }}">
    <input type="submit" value="Search">
</form>






<div class="quotes-container">
    {% for quote in quotes %}
    <div class="quote-container">
        <!-- Render the highlighted quote with HTML tags -->
        <p>{{ quote.quote }}</p>

        {% if quote.image_url %}
            <img src="{{ url_for('static', filename='author_images/' + quote.image_url) }}" alt="{{ quote.author }}" class="author-image"/>
        {% endif %}


        <!-- Linking the author's name to their quotes page -->
        <p class="author">Author:
            <a href="https://thinkexist.net/quotes/{{ quote.author|replace(' ', '%20') }}" class="author-link">
                {{ quote.author }}
            </a>
        </p>

        <!-- Add the "More Info" button -->
        <!-- <button class="more-info-button" onclick="toggleMoreInfo({{ loop.index }}, '{{ quote.quote.replace("'", "\\'").replace('"', '&quot;') }}', '{{ quote.author.replace("'", "\\'").replace('"', '&quot;') }}')">More Info</button>  -->

        <!-- Dropdown Content -->
        <div class="dropdown-content">
            <form action="{{ url_for('collections.add_to_collection') }}" method="POST">
                <select name="collection_id">
                    {% for collection in current_user.collections %}
                        <option value="{{ collection.id }}">{{ collection.name }}</option>
                    {% endfor %}
                    <option value="new">Create New Collection</option>
                </select>
                <input type="hidden" name="quote_id" value="{{ quote.id }}">
                <input type="submit" value="Add to Collection">
            </form>
        </div>

        <!-- More Information Section (Initially hidden) -->
        <div id="more-info-section-{{ loop.index }}" style="display: none;">
            <h3>Additional Information</h3>
            <p class="openai-info"></p>
        </div>
    </div>
    {% endfor %}
</div>

<!-- Pagination navigation -->
<div class="pagination">
    <ul>
        <!-- Previous Page Link -->
        {% if page > 1 %}
            <li><a href="{{ url_for('es_search', query=query, page=page-1) }}">Previous</a></li>
        {% else %}
            <li class="disabled">Previous</li>
        {% endif %}

        <!-- Individual Page Links -->
        {% set links_shown = 5 %} <!-- Number of links to show around the current page -->
        {% for p in range(1, total_pages + 1) %}
            {% if p == 1 or p == total_pages or (page - links_shown <= p <= page + links_shown) %}
                {% if p != page %}
                    <li><a href="{{ url_for('es_search', query=query, page=p) }}">{{ p }}</a></li>
                {% else %}
                    <li class="active">{{ p }}</li>
                {% endif %}
            {% elif p == page - links_shown - 1 or p == page + links_shown + 1 %}
                <li class="disabled">...</li>
            {% endif %}
        {% endfor %}

        <!-- Next Page Link -->
        {% if page < total_pages %}
            <li><a href="{{ url_for('es_search', query=query, page=page+1) }}">Next</a></li>
        {% else %}
            <li class="disabled">Next</li>
        {% endif %}
    </ul>
</div>



<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('#search-input').on('input', function() {
            var query = $(this).val();
            if (query.length >= 2) {
                $.ajax({
                    url: '/autocomplete',
                    data: { 'query': query },
                    success: function(data) {
                        var suggestions = data.map(function(item) {
                            return '<div class="suggestion-item">' + item.quote + '</div>';
                        });
                        $('#autocomplete-results').html(suggestions.join(''));
                    }
                });
            } else {
                $('#autocomplete-results').empty();
            }
        });

        $(document).on('click', '.suggestion-item', function() {
            $('#search-input').val($(this).text());
            $('#autocomplete-results').empty();
            // Optionally trigger a search here
        });
    });
</script>
<style>
    #autocomplete-results {
        border: 1px solid #ccc;
        position: absolute;
        z-index: 1001;
        background-color: white;
    }
    .suggestion-item {
        padding: 5px;
        cursor: pointer;
    }
    .suggestion-item:hover {
        background-color: #f0

</style>
{% endblock %}
